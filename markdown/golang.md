# Go Language
본 문서는 [Go 언어 웹 프로그래밍 철저 입문](https://thebook.io/006806/ch01/) 자료를 공부한 뒤 정리한 내용이다.



## 1. 객체 지향 프로그래밍

### 1.1 객체 표현 방식

Go는 상태를 표현하는 '타입'과 동작을 표현하는 '메서드'를 분리하여 정의한다.

#### 사용자 정의 타입과 메서드

- **사용자 정의 타입**으로 구조체와 인터페이스, 기본 타입(string, int, slice, map, channel 등), 함수 서명을 지정해서 사용한다.
- **메서드**는 사용자 정의 타입과 함수를 **바인딩**시키는 방식으로 정의한다.
- 메서드를 정의할 때는 어떤 타입과 연결할지 **리시버(receiver)** 를 지정해준다.
    ```go
    func (리시버명 리시버타입) 메서드명(매개변수) (반환타입 또는 반환값) {
        // body
    }
    ```


### 1.2 구조체

```go
type 타입명 struct {
    필드명1 필드타입1
    필드명2 필드타입2
    ...
}
```

#### 구조체 임베딩

- 상속을 사용하게 되면 클래스들이 거대한 트리 구조가 되고, 이는 여러 문제를 유발한다.
- 그래서 디자인 패턴에서는 **상속보다는 조합**을 강조한다.
- 사용자 정의 타입을 구조체의 필드로 지정하는 것을 **임베딩**이라 한다.
- 구조체 임베딩의 편리한 점은 임베디드 필드가 포함된 구조체에서 임베디드 필드에 정의된 메서드를 그대로 사용할 수 있다는 것이다.
    ```go
    type 타입명 struct {
        타입1 // 임베디드 필드
        타입2 // 임베디드 필드
        …
    }
    
    type 타입1 struct {
        …
    }
    type 타입2 struct {
        …
    }
    ```

#### 정보 은닉

- Go는 식별자의 첫 번째 문자가 대문자인지 소문자인지에 따라 public과 private를 구분한다.


### 1.3 인터페이스

```go
type 인터페이스명 interface {
    메서드1(매개변수) 반환타입
    메서드2(매개변수) 반환타입
}
```

#### 인터페이스 특징

- 인터페이스(interface)의 역할은 **객체의 동작을 표현**하는 것이다.
- 함수나 메서드의 매개변수로 인터페이스를 사용하는 것은 ‘값의 타입이 무엇인지’ 보다 오직 **‘값이 무엇을 할 수 있는지’** 에만 집중하게 해준다.
- 인터페이스 이름은 메서드 이름에 er(또는 r)을 붙여서 짓는다.

#### 다형성

- 다형성이란 **다양한 타입의 객체가 같은 메시지를 통해 다양한 방식으로 동작하게 하는 것**을 말한다.
- Go는 인터페이스로 다형성을 지원한다.

#### 인터페이스 임베딩

- 임베디드된 인터페이스의 메서드 서명을 직접 갖고 있는 것과 같은 효과를 준다.
    ```go
    type 인터페이스명 interface {
        인터페이스1 // 임베디드 필드
        인터페이스2 // 임베디드 필드
        …
    }
    
    type 인터페이스1 interface {
        …
    }
    type 인터페이스2 interface {
        …
    }
    ```



## 2. 병행 처리

### 2.1 고루틴

고루틴(goroutine)은 **Go 프로그램 안에서 동시에 독립적으로 실행되는 흐름의 단위**로, 스레드와 비슷한 개념이다.
고루틴은 정보를 공유하는 방식이 아니라 서로 메시지를 주고받는 방식으로 동작한다.

```go
func f() {
    // body
}

func main() {
    go f() // 고루틴 생성
}
```

#### 고루틴 특징

- 실행 중인 고루틴이 있어도 메인 함수가 종료되면 프로그램이 종료된다.
- 프로그램이 비정상적으로 종료되는 것을 피하기 위해 메인 함수에서 고루틴의 종료 상황을 확인할 수 있는 **채널**을 만들고, 만든 채널을 통해 종료 메시지를 대기시킨다.


### 2.2 채널

채널(channel)은 **고루틴끼리 정보를 교환하고 실행의 흐름을 동기화하기 위해 사용**한다.

<img src="https://user-images.githubusercontent.com/55284181/125278294-821f2c00-e34d-11eb-9cdf-cac776027efe.jpg" width="600">

+ **채널 선언**
```go
// 채널 변수 선언 후 make() 함수로 채널 생성
var ch chan string
ch = make(chan string)
 
// make() 함수로 채널 생성 후 바로 변수에 할당
done := make(chan bool)
```

+ **채널로 값 송수신**
```go
ch <- "msg" // ch 채널에 "msg" 전송
m := <- ch  // ch 채널로부터 메시지 수신
```

#### 채널 특징

- 채널을 정의할 때 지정한 데이터의 타입만 채널을 통해 주고받을 수 있다.
- 타입에 상관없이 주고받을 수 있게 하려면 chan interface{}처럼 채널의 타입을 interface{}로 지정하면 된다.
- 채널로 값을 주고받을 때는 <- 연산자를 사용한다.
- 채널이 비어 있지 않으면 전송되지 않고, 채널에 값이 들어오기 전에는 수신되지 않는다.

#### 채널 방향

채널은 기본적으로 양방향 통신이 가능한 상태로 만들어진다. 하지만 실제로는 채널을 구조체의 필드로 사용하거나 함수의 매개변수로 전달하는 것이 일반적인데, 이때는 채널이 대부분 단방향으로만 사용된다. 채널을 단방향으로 사용할 때는 반드시 방향을 지정해주는 것이 좋다.

+ **단방향 채널 선언**
```go
// 단방향 채널 선언
chan<- string // 송신 전용 채널
<-chan string // 수신 전용 채널
```

#### 버퍼드 채널

채널은 지정한 크기의 버퍼를 가질 수 있다.

+ **버퍼드 채널 선언**
```go
ch := make(chan int, 100) // 크기가 100인 버퍼를 가진 채널
```

#### close & range

채널에 더 이상 전송할 값이 없으면 채널을 닫을 수 있다. 채널을 닫는 것은 필수가 아니므로, 수신자가 채널에 더 이상 들어올 값이 없다는 것을 알아야 할 때만(예를 들면 range로 루프를 돌며 메시지를 읽어나갈 때) 채널을 닫아주면 된다.

```go
close(ch)
```

#### select

select 문은 하나의 고루틴이 여러 채널과 통신할 때 사용한다. case로 여러 채널을 대기시키고 있다가 실행 가능 상태가 된 채널이 있으면 해당 케이스를 수행한다.



## 3. encoding/json 패키지

#### Marshaling
논리적 구조를 로우 바이트로 변경하는 것을 '마샬링(Marshaling)' 혹은 '인코딩(Encoding)'이라 표현한다. 정수형이나 구조체 같은 Go value를 바이트 슬라이스로 변경하는 것이다.

```go
func Marshal(v interface{}) ([]byte, error)
```

- 예제 코드
    ```go
    type User struct {
        Name string `json:"name"`
        Age  int    `json:"age"`
    }

    var u = User {"Gopher", 7}
    b, _ := json.Marshal(u)
    fmt.Println(b)          // [123 34 78 97 109 101 34 58 34 ...]
    fmt.Println(string(b))  // {"Name":"Gopher","Age":7}
    ```

#### Unmarshaling
반대로 바이트 슬라이스나 문자열을 논리적 자료 구조로 변경하는 것을 언마샬링(Unmashaling)이라고 한다.

```go
func Unmarshal(data []byte, v interface{}) error
```

- 예제 코드
    ```go
    var s = `{"name":"gopher","age":7}`
    var u User
    json.Unmarshal([]byte(s), &u)
    fmt.Printf("%+v\n", u)  // {Name:gopher Age:7}
    ```




---
##### reference
- [Go encoding/json 패키지](https://jeonghwan-kim.github.io/dev/2019/01/18/go-encoding-json.html)