# HTTP, 웹 서버 구조
본 문서는 nclab 커리큘럼 웹서버-실습-2 내용을 공부하고 정리한 문서이다.

## 1. HTTP 프로토콜
    HyperText Transfer Protocol
    - 하이퍼텍스트(HTML) 문서를 교환하기 위해 만들어진 통신 규약
    - 클라이언트가 HTTP request를 서버에 보내면 서버는 HTTP response를 보내는 구조
    - HTTP는 TCP/IP 기반으로 되어있다.

### TCP/IP
* 인터넷에서 컴퓨터들이 서로 정보를 주고받는 데 쓰이는 통신규약(프로토콜)의 모음
* 패킷 통신 방식의 인터넷 프로토콜인 IP와 전송 조절 프로토콜인 TCP로 이루어져 있다.

* **TCP**
    - 패킷을 목적지까지 어떻게 안정적으로 보낼 것인가에 대해 정의한 프로토콜
    - IP로 컴퓨터의 위치를 찾은 다음, 해당 프로토콜을 사용하여 패킷을 전송
    - TCP는 연결 확립과 보내진 패킷의 확인, 순서화, 전달 중 손상된 패킷을 복구하는 책임을 짐

* **IP**
    - 인터넷 프로토콜(Internet Protocol)의 약자
    - 호스트에서 호스트까지의 통신, 즉 보내는 컴퓨터에서 받는 컴퓨터까지의 통신을 책임지는 프로토콜
    - 각 장치들을 구분하기 위해 IP 주소를 부여함
    - IP 주소는 4개의 숫자로 구성되며 숫자의 크기에 따라 IPv4, IPv6 로 나뉨

* **TCP/IP 계층**
    1. 네트워크 인터페이스 계층
        - Node-To-Node간의 신뢰성 있는 데이터 전송을 담당하는 계층
        - OSI7 계층의 물리 계층과 데이터링크 계층의 역할 담당
    2. 인터넷 계층 (Internet Layer)
        - 호스트간의 라우팅을 담당하는 계층
        - OSI7 계층의 네트워크 계층의 역할 담당
        - 대표적인 프로토콜 : IP, ARP ...
    3. 전송 계층 (Transport Layer)
        - 프로세스간의 신뢰성 있는 데이터 전송을 담당하는 계층
        - OSI7 계층의 전송계층의 역할 담당
        - 대표적인 프로토콜 : TCP, UDP
    4. 응용 계층 (Application Layer)
        - 사용자와 가장 가까운 계층
        - 서버나 클라이언트 응용 프로그램이 이 계층에서 동작
        - OSI7계층의 5계층부터 7계층까지의 기능을 담당
        - 대표적인 프로토콜 : HTTP, Telnet, SSH ...

![TCP/IP 계층](https://user-images.githubusercontent.com/55284181/111994395-11b08d00-8b5b-11eb-863f-091e24a7b5de.png)

### HTTP header
* 해당 request에 대한 추가 정보(addtional information)를 담고 있는 부분
* Key:Value 값으로 되어있다 (: 이 사용됨)

* **자주 사용되는 headers**
    - Host : 요청이 전송되는 target의 host url
    - User-Agent : 요청을 보내는 클라이언트의 대한 정보
    - Accept : 해당 요청이 받을 수 있는 응답(response) 타입
    - Connection : 해당 요청이 끝난후에 클라이언트와 서버가 계속해서 네트워크 컨넥션을 유지 할것인지 아니면 끊을것인지에 대해 지시하는 부분
    - Content-Type : 해당 요청이 보내는 메세지 body의 타입
    - Content-Length : 메세지 body의 길이

### HTTP Body
* 해당 reqeust의 실제 메세지/내용
* GET request들은 body가 없는 경우가 많음

### HTTP Method
* 해당 request가 의도한 action을 정의하는 부분
* HTTP Methods에는 GET, POST, PUT, DELETE, OPTIONS 등등이 있다.

* **자주 사용되는 HTTP Methods**
    - GET : 데이터를 서버로부터 받아올 때 주로 사용하는 Method. 데이터 생성/수정/삭제 없이 받아오기만 할때 사용됨
    - POST : 데이터를 생성/수정/삭제 할때 주로 사용되는 Method. 대부분의 경우 request body가 포함되서 보내짐

* **알고 있으면 좋은 HTTP Methods**
    - OPTIONS : 주로 요청 URI에서 사용할 수 있는 Method를 받아올때 사용
    - PUT : POST와 비슷하다. 데이터를 생성 할때 사용되는 Method
    - DELETE : 특정 데이터를 서버에서 삭제 요청을 보낼때 쓰이는 Method

### URL
* 네트워크 상에서 자원이 어디 있는지를 알려주기 위한 규약

* **URL의 구성 요소**
![URL 구성요소](https://user-images.githubusercontent.com/55284181/111994472-2a20a780-8b5b-11eb-8c9d-d8224abe6e92.png)
    1. 프로토콜
        - 컴퓨터끼리 네트워크 통신을 할 때 규격
        - 웹을 이용할 때는 HTTP 프로토콜을 이용
    2. 호스트 주소
        - 도메인 네임 혹은 IP 주소 등 컴퓨터의 주소 표시
    3. 포트 번호
        - 컴퓨터에서 실행되고 있는 수많은 프로세스들의 주소
        - 기본적으로 포트번호를 입력하지 않았을 때는 프로토콜이 가지고 있는 기본 포트번호가 적용
    4. 경로
        - 서버 프로그램 내에 짜인 로직으로 가는 영역
    5. 쿼리
        - URL에서 추가적인 데이터를 표현할 때 사용

## 2. 웹 프레임워크
    웹 프로그램을 개발하기 위해서 필요한 기본적인 구조를 구현하는 클래스와 라이브러리 집합체
![웹 프레임워크](https://user-images.githubusercontent.com/55284181/112002610-6b1cba00-8b63-11eb-9f97-436bd4b8a566.jpg)
* **라우터**
    - http 메서드와 URL 패턴별로 핸들러를 등록하고, 웹 요청이 들어왔을 때 적절한 핸들러로 연결해주는 역할
* **핸들러**
    - http 메서드에 맞는 모든 handlers를 반복하면서 요청 URL에 해당하는 hadler를 찾아서 수행
* **미들웨어**
    - 에러 처리, 웹 요청에 대한 인증 처리, 웹 요청 내용 파싱 등 거의 모든 핸들러 함수에서 반복되는 작업들 수행
    - 미들웨어 여러 개를 체인 형태로 묶어서 사용

### 쿠키
* 클라이언트(브라우저) 로컬에 저장되는 키와 값이 들어있는 작은 데이터 파일
* 사용자 인증이 유효한 시간을 명시할 수 있으며, 유효 시간이 정해지면 브라우저가 종료되어도 인증이 유지됨

* **쿠키의 구성 요소**
    - 이름 : 각각의 쿠키를 구별하는 데 사용되는 이름
    - 값 : 쿠키의 이름과 관련된 값
    - 유효시간 : 쿠키의 유지시간
    - 도메인 : 쿠키를 전송할 도메인
    - 경로 : 쿠키를 전송할 요청 경로

* **쿠키의 동작 방식**
    1. 클라이언트가 페이지를 요청
    2. 서버에서 쿠키를 생성
    3. HTTP 헤더에 쿠키를 포함 시켜 응답
    4. 브라우저가 종료되어도 쿠키 만료 기간이 있다면 클라이언트에서 보관하고 있음
    5. 같은 요청을 할 경우 HTTP 헤더에 쿠키를 함께 보냄
    6. 서버에서 쿠키를 읽어 이전 상태 정보를 변경 할 필요가 있을 때 쿠키를 업데이트 하여 변경된 쿠키를 HTTP 헤더에 포함시켜 응답

### 세션
* 세션은 쿠키를 기반하고 있지만, 사용자 정보 파일을 브라우저에 저장하는 쿠키와 달리 세션은 서버 측에서 관리함
* 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지

* **세션의 동작 방식**
    1. 클라이언트가 서버에 접속 시 세션 ID를 발급받습니다.
    2. 클라이언트는 세션 ID에 대해 쿠키를 사용해서 저장하고 가지고 있습니다.
    3. 클라이언트는 서버에 요청할 때, 이 쿠키의 세션 ID를 서버에 전달해서 사용합니다.
    4. 서버는 세션 ID를 전달 받아서 별다른 작업없이 세션 ID로 세션에 있는 클라언트 정보를 가져옵니다.
    5. 클라이언트 정보를 가지고 서버 요청을 처리하여 클라이언트에게 응답합니다.

***
### reference
- [HTTP 구조 및 핵심 요소](https://velog.io/@teddybearjung/HTTP-%EA%B5%AC%EC%A1%B0-%EB%B0%8F-%ED%95%B5%EC%8B%AC-%EC%9A%94%EC%86%8C)
- [TCP와 IP 위키백과](https://ko.wikipedia.org/wiki/%EC%9D%B8%ED%84%B0%EB%84%B7_%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C_%EC%8A%A4%EC%9C%84%ED%8A%B8)
- [TCP/IP 프로토콜](https://underground2.tistory.com/5)
- [TCP/IP 계층 기본 개념](https://reakwon.tistory.com/68)
- [URL 구조 이해하기](https://www.grabbing.me/URL-018cdd1bb4b541fab6246569244fcf93)
- [Web framework](https://velog.io/@lucasonestar/Web-framework%EC%9B%B9-%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC)
- [더북(TheBook): Go 언어 웹 프로그래밍 철저 입문](https://thebook.io/006806/)
- [쿠키와 세션 개념](https://interconnection.tistory.com/74)
